<html>

<head>
    <title>Negotiation Bot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>

<style>
    h1 {
        background-color: white;
        text-align: center;
    }

    h2 {
        background-color: white;
        text-align: center;
    }

    .selectionText {
        cursor: pointer;
        background-color: white;
        border-style: solid;
        border-width: 2px;
        border-radius: 5px;
        border-color: lightgray;
        display: inline-block;
    }

    .selectionText:hover {
        background-color: lightslategray;
    }

    .chatbox {
        max-height: 80%;
        overflow-y: scroll;
        border: solid;
        border-radius: 5px;
        border-color: gray;
        border-width: 1px;
        margin-bottom: 10px;
        margin-top: 3px;
        min-height: 650px;
    }

    .textGroup {
        margin-top: 50px;
    }

    
    .submitButton {
        margin-top: 50px;
        display: flex;
    }
 
    .acceptButton {
        flex: 1;
        bottom:0;
    right:0;
    }

    .dropdown-menu{
        overflow: visible;
        max-height:300px;
        overflow-y: scroll;
    }
 

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>



<script>
    var messageCounter = 1;

    function disablePreviousMessage() {
        console.trace("Message counter : %s", messageCounter);
        $("#dropdownMenuButton"+messageCounter).addClass("disabled");
        $("#dropdownMenuButton"+(messageCounter+1)).addClass("disabled");
        $("#dropdownMenuButton"+(messageCounter+2)).addClass("disabled");
        $("#dropdownMenuButton"+(messageCounter+3)).addClass("disabled");
    }

    function displayUserResponse() {
        console.trace("Message counter increased : %s", messageCounter);
        messageCounter = messageCounter + 4;

        $('#aiResponse').append(
            `<div class="textGroup mt-5 h2">
                    I want to
                    <!-- Example split danger button -->
                    <div class="dropdown selectionText">
                        <div class="dropdown-toggle" id="dropdownMenuButton`+messageCounter+`" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">X</div>
                        <div class="dropdown-menu" id="dm`+(messageCounter)+`">
                        <li><a class="dropdown-item" href="#">EAT TRADITIONAL FOOD</a></li>
                        <li><a class="dropdown-item" href="#">GO CAMPING</a></li>
                        <li><a class="dropdown-item" href="#">GO HIKING</a></li>
                        <li><a class="dropdown-item" href="#">GO SKIING</a></li>
                        <li><a class="dropdown-item" href="#">GO SWIMMING</a></li>
                        <li><a class="dropdown-item" href="#">GO TO CINEMA</a></li>
                        <li><a class="dropdown-item" href="#">GO TO THEATRE</a></li>
                        <li><a class="dropdown-item" href="#">JOIN WALKING TOUR</a></li>
                        <li><a class="dropdown-item" href="#">VISIT CAVES</a></li>
                        <li><a class="dropdown-item" href="#">VISIT MUSEUMS</a></li>
                        </div>
                    </div>

                    for
                    <div class="dropdown selectionText">
                        <div class="dropdown-toggle" id="dropdownMenuButton`+(messageCounter+1)+`" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">X</div>
                        <div class="dropdown-menu" id="dm`+(messageCounter+1)+`">
                        <li><a class="dropdown-item" href="#">3 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">4 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">1 WEEK</a></li>
                        <li><a class="dropdown-item" href="#">2 WEEKS</a></li>
                        <li><a class="dropdown-item" href="#">3 WEEKS</a></li>
                        <li><a class="dropdown-item" href="#">1 MONTH</a></li>
                        <li><a class="dropdown-item" href="#">2 MONTH</a></li>
                        </div>
                    </div>
                    in
                    <div class="dropdown selectionText">
                        <div class="dropdown-toggle" id="dropdownMenuButton`+(messageCounter+2)+`" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">X</div>
                        <div class="dropdown-menu" id="dm`+(messageCounter+2)+`">
                        <li><a class="dropdown-item" href="#" id="option1">CHINA</a></li>
                        <li><a class="dropdown-item" href="#" id="option2">FRANCE</a></li>
                        <li><a class="dropdown-item" href="#" id="option3">GERMANY</a></li>
                        <li><a class="dropdown-item" href="#" id="option4">GREECE</a></li>
                        <li><a class="dropdown-item" href="#" id="option5">ITALY</a></li>
                        <li><a class="dropdown-item" href="#" id="option6">MEXICO</a></li>
                        <li><a class="dropdown-item" href="#" id="option7">SPAIN</a></li>
                        <li><a class="dropdown-item" href="#" id="option8">THAILAND</a></li>
                        <li><a class="dropdown-item" href="#" id="option9">UNITED KINGDOM</a></li>
                        <li><a class="dropdown-item" href="#" id="option10">UNITED STATES</a></li>
                        </div>
                    </div>
                    starting
                    <div class="dropdown selectionText">
                        <div class="dropdown-toggle" id="dropdownMenuButton`+(messageCounter+3)+`" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">X</div>
                        <div class="dropdown-menu" id="dm`+(messageCounter+3)+`">
                        <li><a class="dropdown-item" href="#">TODAY</a></li>
                        <li><a class="dropdown-item" href="#">3 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">NEXT WEEK</a></li>
                        <li><a class="dropdown-item" href="#">10 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">2 WEEK</a></li>
                        <li><a class="dropdown-item" href="#">NEXT MONTH</a></li>
                        <li><a class="dropdown-item" href="#">NEXT YEAR</a></li>
                        </div>
                    </div>
                    .
            </div><br>`
        ).hide().fadeIn('fast');;
        $("#dm"+messageCounter+" li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton"+(messageCounter)).html(selText);
        });
        $("#dm"+(messageCounter+1)+" li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton"+(messageCounter+1)).html(selText);
        });
        $("#dm"+(messageCounter+2)+" li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton"+(messageCounter+2)).html(selText);
        });
        $("#dm"+(messageCounter+3)+" li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton"+(messageCounter+3)).html(selText);
        });

        $('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);

    }

    function displayAIresponse(response) {
        // console.log("[AI RESPONSE] Activity: %s, Duration: %s, Location: %s, StartTime: %s",
        //     response.activity,
        //     response.duration,
        //     response.location,
        //     response.startTime
        // );


        var aiResponseSpan = `<h2>
        <span style="color: #72acd4 ;">AI : </span>I want to `+response.activity+` 
        for `+response.duration+` 
        in `+response.location+`
        starting `+response.startTime+`.</h2>`
        console.log(aiResponseSpan);
        $('#aiResponse').append(aiResponseSpan + '<br>');
    }

    // Sends the user input to the server
    function sendMessage() {
        // Send the message to server
        console.trace("Sending message to server...");

        var form = document.getElementById("inputForm");
        $.post("/getAIresponse", {
            activity: $("#dropdownMenuButton"+messageCounter).text(), // User input
            duration: $("#dropdownMenuButton"+(messageCounter+1)).text(),
            location: $("#dropdownMenuButton"+(messageCounter+2)).text(),
            startTime: $("#dropdownMenuButton"+(messageCounter+3)).text()
        }).done(function (data) {
            console.trace("[Time: %s] Got response back from the server!", data.timestamp);
            disablePreviousMessage();
            displayAIresponse(data);
            displayUserResponse();
        });

    }

    $(document).ready(function () {
        $("#dm1 li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton1").html(selText);
        });
        $("#dm2 li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton2").html(selText);
        });
        $("#dm3 li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton3").html(selText);
        });
        $("#dm4 li a").click(function () {
            var selText = $(this).text();
            $("#dropdownMenuButton4").html(selText);
        });
        $.get("/getUserID", {}).
        done(function (data) {
            console.trace("Got user ID back from the server!");
            $("#userID").text("User ID : " + data);
        });

        // $.ajax({
        //     type: 'POST',
        //     data: {
        //         'dropdownMenuButton': 'dropdownMenuButton',
        //         'dropdownMenuButton2': 'dropdownMenuButton2'  
        //     },
        //     success: function () {
        //         alert('x');
        //     }
        // });
        
    });

</script>

<body>
    <div id="mainContainer" class="container-fluid text-center align-items-center justify-content-between" >
        <h1>
            NegotiatorBot
        </h1>
        <span id="userID" class="text-center" style="color: gray;"></span>

            <!-- <form id="inputForm" action="/getAIresponse" method="post">
                Ben X 3 haftalik tatile gitmek istiyorum.           
                <input id="userInputMessage" type="text" name="userMessage" size="35">
            </form> -->

            <div id="chatbox" class="chatbox" >

            
            <div class="textGroup mt-5 h2">
                I want to
                <!-- Example split danger button -->
                <div class="dropdown selectionText">
                    <div class="dropdown-toggle" id="dropdownMenuButton1" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">X</div>
                    <div class="dropdown-menu" id="dm1" >
                        <li><a class="dropdown-item" href="#">EAT TRADITIONAL FOOD</a></li>
                        <li><a class="dropdown-item" href="#">GO CAMPING</a></li>
                        <li><a class="dropdown-item" href="#">GO HIKING</a></li>
                        <li><a class="dropdown-item" href="#">GO SKIING</a></li>
                        <li><a class="dropdown-item" href="#">GO SWIMMING</a></li>
                        <li><a class="dropdown-item" href="#">GO TO CINEMA</a></li>
                        <li><a class="dropdown-item" href="#">GO TO THEATRE</a></li>
                        <li><a class="dropdown-item" href="#">JOIN WALKING TOUR</a></li>
                        <li><a class="dropdown-item" href="#">VISIT CAVES</a></li>
                        <li><a class="dropdown-item" href="#">VISIT MUSEUMS</a></li>
                    </div>
                </div>

                for
                <div class="dropdown selectionText">
                    <div class="dropdown-toggle" id="dropdownMenuButton2" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">X</div>
                    <div class="dropdown-menu" id="dm2" >
                        <li><a class="dropdown-item" href="#">3 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">4 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">1 WEEK</a></li>
                        <li><a class="dropdown-item" href="#">2 WEEKS</a></li>
                        <li><a class="dropdown-item" href="#">3 WEEKS</a></li>
                        <li><a class="dropdown-item" href="#">1 MONTH</a></li>
                        <li><a class="dropdown-item" href="#">2 MONTH</a></li>
                    </div>
                </div>
                in
                <div class="dropdown selectionText">
                    <div class="dropdown-toggle" id="dropdownMenuButton3" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">X</div>
                    <div class="dropdown-menu" id="dm3">
                        <li><a class="dropdown-item" href="#" id="option1">CHINA</a></li>
                        <li><a class="dropdown-item" href="#" id="option2">FRANCE</a></li>
                        <li><a class="dropdown-item" href="#" id="option3">GERMANY</a></li>
                        <li><a class="dropdown-item" href="#" id="option4">GREECE</a></li>
                        <li><a class="dropdown-item" href="#" id="option5">ITALY</a></li>
                        <li><a class="dropdown-item" href="#" id="option6">MEXICO</a></li>
                        <li><a class="dropdown-item" href="#" id="option7">SPAIN</a></li>
                        <li><a class="dropdown-item" href="#" id="option8">THAILAND</a></li>
                        <li><a class="dropdown-item" href="#" id="option9">UNITED KINGDOM</a></li>
                        <li><a class="dropdown-item" href="#" id="option10">UNITED STATES</a></li>
                    </div>
                </div>
                starting
                <div class="dropdown selectionText">
                    <div class="dropdown-toggle" id="dropdownMenuButton4" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">X</div>
                    <div class="dropdown-menu" id="dm4">
                        <li><a class="dropdown-item" href="#">TODAY</a></li>
                        <li><a class="dropdown-item" href="#">3 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">NEXT WEEK</a></li>
                        <li><a class="dropdown-item" href="#">10 DAYS</a></li>
                        <li><a class="dropdown-item" href="#">2 WEEK</a></li>
                        <li><a class="dropdown-item" href="#">NEXT MONTH</a></li>
                        <li><a class="dropdown-item" href="#">NEXT YEAR</a></li>
                    </div>
                </div>
                .
            </div>

            

                <div id="aiResponse">

                </div>
                <br> <br>
            </div>


            <div>
                <button class="btn btn-outline-dark" id="submitButton" onclick="sendMessage()">Submit</button>
                <button class="btn btn-outline-dark" style="display: inline-block;"> Accept</button>
            </div>
            </div>



    </div>
</body>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script>


    function displaySelection(val) {
        console.trace("clicked on : ");
        console.trace(val.getAttribute("value"));
    }


</script>

</html>